
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Naturpellet - Seguimiento Completo de Prospectos</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f3f0;
            color: #333;
        }

        header {
            background: linear-gradient(135deg, #5a4a3a 0%, #6b4d32 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header h1 {
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(90, 74, 58, 0.1);
            border-top: 4px solid #d4af37;
        }

        .stat-card h3 {
            font-size: 2.5em;
            color: #5a4a3a;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-weight: bold;
        }

        .form-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(90, 74, 58, 0.1);
        }

        .form-section h2 {
            color: #5a4a3a;
            margin-bottom: 20px;
            border-left: 4px solid #d4af37;
            padding-left: 15px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #5a4a3a;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #d4af37;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #5a4a3a;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            margin-top: 10px;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            background: #d4af37;
            color: #5a4a3a;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
        }

        .file-upload-btn:hover {
            background: #c19b28;
        }

        .file-list {
            margin-top: 10px;
        }

        .file-item {
            background: #f9f7f4;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item .remove-file {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-primary {
            background: #6b4d32;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .btn-primary:hover {
            background: #5a4a3a;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .search-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(90, 74, 58, 0.1);
        }

        .search-grid {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: end;
        }

        .search-input {
            padding: 10px;
            border: 2px solid #d4af37;
            border-radius: 6px;
            font-size: 16px;
        }

        .table-section {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(90, 74, 58, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th {
            background: #5a4a3a;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        table tbody tr:hover {
            background: #f9f7f4;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-inicial { background: #e8f4fd; color: #2980b9; }
        .status-seguimiento { background: #fff3cd; color: #856404; }
        .status-cotizacion { background: #d4edda; color: #155724; }
        .status-negociacion { background: #ffeaa7; color: #d63031; }
        .status-compra { background: #d1ecf1; color: #0c5460; }
        .status-postventa { background: #d4edda; color: #155724; }

        .actions {
            display: flex;
            gap: 5px;
        }

        .btn-edit {
            background: #f39c12;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-view {
            background: #27ae60;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .search-grid {
                grid-template-columns: 1fr;
            }

            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            table {
                font-size: 14px;
            }

            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üêøÔ∏è CRM Naturpellet</h1>
        <p>Sistema de Seguimiento Completo de Prospectos B2B</p>
    </header>

    <div class="container">
        <!-- Dashboard de Estad√≠sticas -->
        <div class="dashboard">
            <div class="stat-card">
                <h3 id="total-prospects">0</h3>
                <p>Total Prospectos</p>
            </div>
            <div class="stat-card">
                <h3 id="active-prospects">0</h3>
                <p>En Seguimiento</p>
            </div>
            <div class="stat-card">
                <h3 id="converted-prospects">0</h3>
                <p>Compraron</p>
            </div>
            <div class="stat-card">
                <h3 id="revenue-potential">0‚Ç¨</h3>
                <p>Potencial Ingresos</p>
            </div>
        </div>

        <!-- Formulario de Prospecto -->
        <div class="form-section">
            <h2 id="form-title">‚ûï A√±adir Nuevo Prospecto</h2>
            <form id="prospect-form">
                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label for="name">Nombre Completo *</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="role">Cargo</label>
                            <input type="text" id="role">
                        </div>
                        <div class="form-group">
                            <label for="company">Empresa *</label>
                            <input type="text" id="company" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="phone">Tel√©fono</label>
                            <input type="tel" id="phone">
                        </div>
                        <div class="form-group">
                            <label for="address">Direcci√≥n</label>
                            <input type="text" id="address">
                        </div>
                        <div class="form-group">
                            <label for="segment">Segmento *</label>
                            <select id="segment" required>
                                <option value="">Seleccionar...</option>
                                <option value="Hotel Rural">Hotel Rural</option>
                                <option value="Ayuntamiento">Ayuntamiento</option>
                                <option value="Industria Agroalimentaria">Industria Agroalimentaria</option>
                                <option value="Pol√≠gono Industrial">Pol√≠gono Industrial</option>
                                <option value="Empresa ESE">Empresa ESE</option>
                                <option value="Residencia/Centro">Residencia/Centro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Estado</label>
                            <select id="status">
                                <option value="Contacto inicial">Contacto inicial</option>
                                <option value="En seguimiento">En seguimiento</option>
                                <option value="Cotizaci√≥n enviada">Cotizaci√≥n enviada</option>
                                <option value="En negociaci√≥n">En negociaci√≥n</option>
                                <option value="Compra realizada">Compra realizada</option>
                                <option value="Servicio post-venta">Servicio post-venta</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="potential-volume">Volumen Potencial (toneladas/a√±o)</label>
                    <input type="number" id="potential-volume" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label for="notes">Notas y Observaciones</label>
                    <textarea id="notes" rows="4" placeholder="Detalles del contacto, necesidades espec√≠ficas, fechas importantes..."></textarea>
                </div>

                <!-- Secci√≥n de Archivos -->
                <div class="form-group">
                    <label>üìé Documentos y Fotos</label>
                    <div class="file-upload">
                        <input type="file" id="file-input" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                        <button type="button" class="file-upload-btn" onclick="document.getElementById('file-input').click()">
                            üìÅ Seleccionar Archivos
                        </button>
                        <small style="color: #666;">Fotos, PDFs, documentos Word/Excel permitidos</small>
                    </div>
                    <div id="file-list" class="file-list"></div>
                </div>

                <button type="submit" class="btn-primary" id="submit-btn">üíæ Guardar Prospecto</button>
                <button type="button" class="btn-secondary" onclick="clearForm()">üîÑ Limpiar Formulario</button>
            </form>
        </div>

        <!-- Secci√≥n de B√∫squeda y Filtros -->
        <div class="search-section">
            <div class="search-grid">
                <input type="text" id="search-input" class="search-input" placeholder="üîç Buscar por nombre, empresa, email...">
                <select id="filter-segment">
                    <option value="">Todos los segmentos</option>
                    <option value="Hotel Rural">Hotel Rural</option>
                    <option value="Ayuntamiento">Ayuntamiento</option>
                    <option value="Industria Agroalimentaria">Industria</option>
                    <option value="Pol√≠gono Industrial">Pol√≠gono</option>
                    <option value="Empresa ESE">ESE</option>
                    <option value="Residencia/Centro">Residencia</option>
                </select>
                <select id="filter-status">
                    <option value="">Todos los estados</option>
                    <option value="Contacto inicial">Contacto inicial</option>
                    <option value="En seguimiento">En seguimiento</option>
                    <option value="Cotizaci√≥n enviada">Cotizaci√≥n</option>
                    <option value="En negociaci√≥n">Negociaci√≥n</option>
                    <option value="Compra realizada">Comprado</option>
                    <option value="Servicio post-venta">Post-venta</option>
                </select>
            </div>
        </div>

        <!-- Tabla de Prospectos -->
        <div class="table-section">
            <table id="prospects-table">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Empresa</th>
                        <th>Segmento</th>
                        <th>Estado</th>
                        <th>Potencial</th>
                        <th>Archivos</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="prospects-tbody">
                    <!-- Los prospectos se cargar√°n aqu√≠ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal para Ver Detalles -->
    <div id="details-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="prospect-details"></div>
        </div>
    </div>

    <script>
        let prospects = [];
        let editingIndex = -1;
        let selectedFiles = [];

        // Datos precargados de ejemplo
        const initialProspects = [
            {
                name: "Juan P√©rez Garc√≠a",
                role: "Director General",
                company: "Hotel Rural El Bosque",
                email: "jperez@bosquehotel.es",
                phone: "600 123 456",
                address: "Ctra. Segovia-Valladolid km 45, Segovia",
                segment: "Hotel Rural",
                status: "En seguimiento",
                potentialVolume: 50,
                notes: "28 habitaciones, spa, consumo anual 60.000‚Ç¨/a√±o. Interesado en cambio de propano a pellets.",
                files: [],
                dateCreated: new Date().toISOString(),
                lastContact: new Date().toISOString()
            },
            {
                name: "Mar√≠a L√≥pez Santos",
                role: "Alcaldesa",
                company: "Ayuntamiento de Cu√©llar",
                email: "mlopez@cuellar.es",
                phone: "923 421 000",
                address: "Plaza Mayor, 1, Cu√©llar, Segovia",
                segment: "Ayuntamiento",
                status: "Cotizaci√≥n enviada",
                potentialVolume: 120,
                notes: "12 edificios municipales, gasto energ√≠a 85.000‚Ç¨/a√±o. Proyecto sostenibilidad municipal.",
                files: [],
                dateCreated: new Date().toISOString(),
                lastContact: new Date().toISOString()
            },
            {
                name: "Elena Mart√≠nez G√≥mez",
                role: "Directora de Producci√≥n",
                company: "Bodega Belondrade y Lurton",
                email: "emartinez@belondrade.com",
                phone: "983 123 456",
                address: "Ctra. Rueda km 12, La Seca, Valladolid",
                segment: "Industria Agroalimentaria",
                status: "En negociaci√≥n",
                potentialVolume: 80,
                notes: "Producci√≥n anual 150.000hl, consumo t√©rmico 40.000‚Ç¨/a√±o. Control temperatura fermentaci√≥n cr√≠tico.",
                files: [],
                dateCreated: new Date().toISOString(),
                lastContact: new Date().toISOString()
            },
            {
                name: "Jos√© Manuel D√≠az",
                role: "Director Comercial",
                company: "Gebio Energ√≠a",
                email: "jmdiaz@gebioenergia.es",
                phone: "923 678 901",
                address: "C/ San Pablo 12, Salamanca",
                segment: "Empresa ESE",
                status: "Compra realizada",
                potentialVolume: 800,
                notes: "Cobertura CyL, Madrid, Asturias. Cliente mayorista establecido. Contrato anual renovado.",
                files: [],
                dateCreated: new Date().toISOString(),
                lastContact: new Date().toISOString()
            },
            {
                name: "Cristina Mart√≠n Ruiz",
                role: "Directora",
                company: "Residencia San Telmo",
                email: "cmartin@santelmo.palencia.es",
                phone: "979 123 456",
                address: "C/ Mayor 7, Palencia",
                segment: "Residencia/Centro",
                status: "Servicio post-venta",
                potentialVolume: 60,
                notes: "120 plazas, consumo energ√©tico 85.000‚Ç¨/a√±o. Calefacci√≥n 24h. Muy satisfechos con servicio.",
                files: [],
                dateCreated: new Date().toISOString(),
                lastContact: new Date().toISOString()
            }
        ];

        // Inicializar aplicaci√≥n
        function initApp() {
            const stored = localStorage.getItem('naturpellet_prospects');
            if (stored) {
                prospects = JSON.parse(stored);
            } else {
                prospects = initialProspects;
                saveProspects();
            }

            renderTable();
            updateDashboard();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('prospect-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('search-input').addEventListener('input', renderTable);
            document.getElementById('filter-segment').addEventListener('change', renderTable);
            document.getElementById('filter-status').addEventListener('change', renderTable);
            document.getElementById('file-input').addEventListener('change', handleFileSelection);

            // Modal
            const modal = document.getElementById('details-modal');
            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = () => modal.style.display = 'none';
            window.onclick = (event) => {
                if (event.target === modal) modal.style.display = 'none';
            }
        }

        function handleFileSelection(event) {
            const files = Array.from(event.target.files);
            selectedFiles = [...selectedFiles, ...files];
            renderFileList();
        }

        function renderFileList() {
            const container = document.getElementById('file-list');
            container.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>üìé ${file.name} (${formatFileSize(file.size)})</span>
                    <button type="button" class="remove-file" onclick="removeFile(${index})">‚úñ</button>
                `;
                container.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFileList();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function handleFormSubmit(event) {
            event.preventDefault();

            const formData = {
                name: document.getElementById('name').value,
                role: document.getElementById('role').value,
                company: document.getElementById('company').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                segment: document.getElementById('segment').value,
                status: document.getElementById('status').value,
                potentialVolume: parseFloat(document.getElementById('potential-volume').value) || 0,
                notes: document.getElementById('notes').value,
                files: selectedFiles.map(f => ({ name: f.name, size: f.size, type: f.type })),
                dateCreated: editingIndex === -1 ? new Date().toISOString() : prospects[editingIndex].dateCreated,
                lastContact: new Date().toISOString()
            };

            if (editingIndex === -1) {
                prospects.push(formData);
            } else {
                prospects[editingIndex] = formData;
                editingIndex = -1;
                document.getElementById('form-title').textContent = '‚ûï A√±adir Nuevo Prospecto';
                document.getElementById('submit-btn').textContent = 'üíæ Guardar Prospecto';
            }

            saveProspects();
            clearForm();
            renderTable();
            updateDashboard();
            alert('‚úÖ Prospecto guardado exitosamente');
        }

        function editProspect(index) {
            const prospect = prospects[index];
            editingIndex = index;

            document.getElementById('name').value = prospect.name;
            document.getElementById('role').value = prospect.role;
            document.getElementById('company').value = prospect.company;
            document.getElementById('email').value = prospect.email;
            document.getElementById('phone').value = prospect.phone;
            document.getElementById('address').value = prospect.address;
            document.getElementById('segment').value = prospect.segment;
            document.getElementById('status').value = prospect.status;
            document.getElementById('potential-volume').value = prospect.potentialVolume;
            document.getElementById('notes').value = prospect.notes;

            selectedFiles = prospect.files || [];
            renderFileList();

            document.getElementById('form-title').textContent = '‚úèÔ∏è Editar Prospecto';
            document.getElementById('submit-btn').textContent = 'üíæ Actualizar Prospecto';

            document.getElementById('prospect-form').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteProspect(index) {
            const prospect = prospects[index];
            if (confirm(`¬øEst√° seguro de eliminar el prospecto "${prospect.name}" de "${prospect.company}"?`)) {
                prospects.splice(index, 1);
                saveProspects();
                renderTable();
                updateDashboard();
                alert('üóëÔ∏è Prospecto eliminado');
            }
        }

        function viewProspect(index) {
            const prospect = prospects[index];
            const modal = document.getElementById('details-modal');
            const content = document.getElementById('prospect-details');

            content.innerHTML = `
                <h2>üë§ ${prospect.name}</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div>
                        <h3>üìã Informaci√≥n B√°sica</h3>
                        <p><strong>Cargo:</strong> ${prospect.role}</p>
                        <p><strong>Empresa:</strong> ${prospect.company}</p>
                        <p><strong>Email:</strong> <a href="mailto:${prospect.email}">${prospect.email}</a></p>
                        <p><strong>Tel√©fono:</strong> <a href="tel:${prospect.phone}">${prospect.phone}</a></p>
                        <p><strong>Direcci√≥n:</strong> ${prospect.address}</p>
                    </div>
                    <div>
                        <h3>üéØ Informaci√≥n Comercial</h3>
                        <p><strong>Segmento:</strong> ${prospect.segment}</p>
                        <p><strong>Estado:</strong> <span class="status-badge status-${getStatusClass(prospect.status)}">${prospect.status}</span></p>
                        <p><strong>Volumen Potencial:</strong> ${prospect.potentialVolume} ton/a√±o</p>
                        <p><strong>Ingreso Estimado:</strong> ${(prospect.potentialVolume * 300).toLocaleString()}‚Ç¨/a√±o</p>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h3>üìù Notas</h3>
                    <div style="background: #f9f7f4; padding: 15px; border-radius: 6px; margin-top: 10px;">
                        ${prospect.notes || 'Sin notas registradas'}
                    </div>
                </div>

                ${prospect.files && prospect.files.length > 0 ? `
                <div style="margin-top: 20px;">
                    <h3>üìé Archivos Adjuntos (${prospect.files.length})</h3>
                    <div style="margin-top: 10px;">
                        ${prospect.files.map(file => `
                            <div class="file-item">
                                <span>üìÑ ${file.name} (${formatFileSize(file.size)})</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}

                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <p style="color: #666; font-size: 14px;">
                        <strong>Creado:</strong> ${new Date(prospect.dateCreated).toLocaleDateString('es-ES')} | 
                        <strong>√öltimo contacto:</strong> ${new Date(prospect.lastContact).toLocaleDateString('es-ES')}
                    </p>
                </div>
            `;

            modal.style.display = 'block';
        }

        function getStatusClass(status) {
            const statusMap = {
                'Contacto inicial': 'inicial',
                'En seguimiento': 'seguimiento',
                'Cotizaci√≥n enviada': 'cotizacion',
                'En negociaci√≥n': 'negociacion',
                'Compra realizada': 'compra',
                'Servicio post-venta': 'postventa'
            };
            return statusMap[status] || 'inicial';
        }

        function renderTable() {
            const tbody = document.getElementById('prospects-tbody');
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const segmentFilter = document.getElementById('filter-segment').value;
            const statusFilter = document.getElementById('filter-status').value;

            let filteredProspects = prospects.filter(prospect => {
                const matchesSearch = 
                    prospect.name.toLowerCase().includes(searchTerm) ||
                    prospect.company.toLowerCase().includes(searchTerm) ||
                    prospect.email.toLowerCase().includes(searchTerm) ||
                    prospect.segment.toLowerCase().includes(searchTerm);

                const matchesSegment = !segmentFilter || prospect.segment === segmentFilter;
                const matchesStatus = !statusFilter || prospect.status === statusFilter;

                return matchesSearch && matchesSegment && matchesStatus;
            });

            tbody.innerHTML = '';

            filteredProspects.forEach((prospect, index) => {
                const originalIndex = prospects.indexOf(prospect);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${prospect.name}</strong><br>
                        <small style="color: #666;">${prospect.role}</small>
                    </td>
                    <td>${prospect.company}</td>
                    <td>${prospect.segment}</td>
                    <td><span class="status-badge status-${getStatusClass(prospect.status)}">${prospect.status}</span></td>
                    <td>${prospect.potentialVolume} ton/a√±o</td>
                    <td>${prospect.files ? prospect.files.length : 0} archivo(s)</td>
                    <td class="actions">
                        <button class="btn-view" onclick="viewProspect(${originalIndex})" title="Ver detalles">üëÅÔ∏è</button>
                        <button class="btn-edit" onclick="editProspect(${originalIndex})" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-delete" onclick="deleteProspect(${originalIndex})" title="Eliminar">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateDashboard() {
            const total = prospects.length;
            const active = prospects.filter(p => ['En seguimiento', 'Cotizaci√≥n enviada', 'En negociaci√≥n'].includes(p.status)).length;
            const converted = prospects.filter(p => ['Compra realizada', 'Servicio post-venta'].includes(p.status)).length;
            const revenue = prospects.reduce((sum, p) => sum + (p.potentialVolume * 300), 0);

            document.getElementById('total-prospects').textContent = total;
            document.getElementById('active-prospects').textContent = active;
            document.getElementById('converted-prospects').textContent = converted;
            document.getElementById('revenue-potential').textContent = revenue.toLocaleString() + '‚Ç¨';
        }

        function clearForm() {
            document.getElementById('prospect-form').reset();
            selectedFiles = [];
            renderFileList();
            editingIndex = -1;
            document.getElementById('form-title').textContent = '‚ûï A√±adir Nuevo Prospecto';
            document.getElementById('submit-btn').textContent = 'üíæ Guardar Prospecto';
        }

        function saveProspects() {
            localStorage.setItem('naturpellet_prospects', JSON.stringify(prospects));
        }

        // Inicializar cuando cargue la p√°gina
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
